<!DOCTYPE html>
<html>
  <head>
    <title>morgan herlocker</title>
    <link rel="stylesheet" href="/site.css">
    <link rel="stylesheet" href="http://yandex.st/highlightjs/7.5/styles/default.min.css">
    <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-46038987-1', 'morganherlocker.com');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
      <h1><a id="home" href="/">morgan herlocker</a></h1>
      <a href="/about">about</a><span style="padding:5px"></span>
      <a href="https://twitter.com/morganherlocker">twitter</a><span style="padding:5px"></span>
      <a href="https://github.com/morganherlocker">github</a><span style="padding:5px"></span>
      <a href="/posts">posts</a>
      <h2 id="mapping-consensus">Mapping Consensus</h2>
<p><img src="/img/consensus.png" alt=""></p>
<p>I have long been enamored with the idea of <a href="https://twitter.com/morganherlocker/status/1063148961656070144">joining and reconciling distributed datasets</a>. With the rise of machine learning in the mapping space, coupled with an ever increasing trend towards crowd sourced mapping (individuals, NGOs, and governments), finding the thread that ties these datasets together is more important than ever. There is more open data in the mapping space than anyone knows what to do with and it is being generated faster than centralized projects like OpenStreetMap are able to ingest it. For example, nearly a year ago, <a href="https://github.com/Microsoft/USBuildingFootprints">Bing released an ML derived dataset of 125 million building footprints under an ODBL license</a>, which is compatible with OpenStreetMap (UPDATE: another <a href="https://github.com/Microsoft/CanadianBuildingFootprints">12 million Canadian footprints</a> were released <a href="https://twitter.com/jharpster/status/1103739755278168065">moments after I publish this piece</a>). The data has yet to be imported due to a host of problems that arise when attempting to process so many changes at once. While maintenance burden is an oft-cited pain point, an even bigger problem is how to detect and resolve conflicts in the data. In other words, <strong><em>how do we come to consensus on our view of the world in the age of global scale sensor networks and competing entities exerting soft power through the map? Is it even possible?</em></strong></p>
<h2 id="last-edit-rule">Last Edit Rule</h2>
<h4 id="-a-b-b-">(a + b == b)</h4>
<p>In traditional centralized mapping, deriving consensus is pretty straightforward. Whoever made the last change wins, and aside from the occasional edit war, this model is powerful in its lack of ambiguity. As a community, each contributor submits to the “last edit monarchy”, because there is so much to gain by having access to an internally consistent global street map of curated data. This model starts to break down, however, when the concepts of “time” and “edit” become fuzzy. The last edit rule only works when we operate on individual human level scales for time and edit complexity, since the curation and reconciliation models require human review. When the supply side dam breaks and 100s of millions of detailed edits can be generated in a few minutes by a swarm of GPUs, the human reviewer model cannot scale to meet the volume. Whether it&#39;s buildings extracted with machine learning from aerial imagery at a rate of millions per minute, or massive street datasets generated by cars and phones collecting ambient GPS telemetry as users go about their day, the volume of useful data is exploding exponentially. How useful is the concept of “last edit” when the last edit included 10 million miles of street centerlines, and no one is quite sure how they overlap with the existing 50 million miles in OpenStreetMap meticulously mapped out over the last decade? <strong>What happens when that volume is regenerated daily?</strong></p>
<h2 id="merge">Merge</h2>
<h4 id="-a-b-c-">(a + b == c)</h4>
<p>Distributed editing of global scale street maps is an unsolved problem, but we can look to similar domains for inspiration. One area where conflict management was similar to the present state of mapping is code authoring. Before <code>git</code>, most of us used source control systems that required “checking out” a file before editing, which put a global lock on the file, almost like checking out a book from the library. This provided a simple method for avoiding conflict, in many ways analogous to the last edit rule used in mapping today. The <a href="https://tasks.hotosm.org/">HOT tasking manager</a> even uses the check out model explicitly where an editor is able to make an exclusive lock on a specific tile while adding data in a dense region. <strong>Conflicts are impossible when there is an unambiguous process for an individual to become the arbiter of truth.</strong> While arguments can still be had over data accuracy, there is a single unambiguous state that cannot be disputed at any given point in time. <strong>Git flipped this model on its head, in large part by taking on an immense responsibility: <em>detecting and fixing conflicts in competing branches of code.</em></strong></p>
<h3 id="detection">Detection</h3>
<h4 id="-a-b-">(a + b = ?)</h4>
<p>Mapping follows a similar pattern to code authoring, in that conflicts are dangerous, but not the norm. It is rare to have multiple coders working on the same lines in a file at the same time, just as it is rare to have multiple editors working on the same object in OpenStreetMap, in comparison to the average. A system that could at least detect issues, could forward most changes through, and this is precisely what makes <code>git merge</code> so powerful. This strategy is commonly used in bespoke OpenStreetMap imports, where code will be written to identify imported features that are far away from existing features, and therefore pose minimal conflict risk.</p>
<h3 id="resolution">Resolution</h3>
<h4 id="-a-b-a-b-">(a + b = a | b)</h4>
<p>When a conflict is detected in <code>git</code>, a best effort attempt will be made to resolve the two branches. If this is not possible, the merge will fail, and the user will be asked to manually decide which branch wins. I have come to believe that these failure modes are inevitable in mapping as well, requiring human intervention. The goal of a resolution strategy should then be to:</p>
<ol>
<li>flag all conflicts</li>
<li>resolve as many conflicts as possible, perhaps taking calculated risks to do so</li>
<li>push irreconcilable issues to human reviewers through a tasking system</li>
</ol>
<p>The fewer edits get pushed to a human reviewer, the more democratized our future maps will be. Evidence for this can be found in Wikipedia&#39;s use of automated vandalism detection, such as <a href="https://en.wikipedia.org/wiki/Wikipedia:Bots/Requests_for_approval/ClueBot_NG">Cluebot NG</a>, as well as Wikipedia&#39;s edit ranking systems, such as <a href="https://www.mediawiki.org/wiki/ORES_review_tool">ORES</a>, which have drastically reduced the need for human review through efficiency gains. While OpenStreetMap suffers less from vandalism than Wikipedia, handling of bulk imports and automated import streams represents a similar existential resourcing challenge.</p>
<h2 id="crdt">CRDT</h2>
<h4 id="-a-b-f-a-b-">(a) + b ==  f(a, b))</h4>
<p>The problem with the strategy above is in phase 2, automated conflict resolution. <strong>Different organizations will have varying risk tolerances, quality requirements, and access to human editors with expertise to resolve complex conflicts.</strong> This means that it may be fundamentally impossible to resolve branching map datasets in a way that is satisfactory to everyone. The <a href="https://wiki.openstreetmap.org/wiki/Import/Past_Problems">vigorous debate around bulk imports in the OpenStreetMap community</a> illustrates how divergent different community’s requirements can be when it comes to this problem.</p>
<p><a href="https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type">Conflict-free replicated data types</a> (CRDT) are one potential solution to this set of issues, as suggested by <a href="https://www.digital-democracy.org/">the brilliant folks</a> working on <a href="https://peermaps.org/">peermaps</a>, a fully p2p global street map used in some <a href="https://www.digital-democracy.org/ourwork/ra/">amazingly impactful offline heavy editing scenarios in the Amazon basin</a>. The idea with the CRDT approach is to link edits together which could potentially conflict, and materialize a de-conflicted view of each feature on the fly. This materialization step would be separate from the primary data storage responsibilities of the map editing infrastructure, opening up the possibility for various resolution strategies depending on the use case. For example, an organization could weight its own editors&#39; edits more heavily or a cautious individual wary of ML derived edits could filter based on source. Default strategies would likely be provided as well, similar to the golden path git merge strategy.</p>
<p>The CRDT strategy or similar is common in certain niches of mapping, such as crowd sourced POIs or ETA modeling where conflicting data is the norm, but significant research is still needed to make this a reality for features with strict topology requirements such as street geometry or tightly packed buildings.</p>
<h2 id="next-">Next?</h2>
<p>The conflation problem is an undertaking that no single entity is capable of solving it alone. I recently joined <a href="http://sharedstreets.io/">SharedStreets</a>, an independent non profit building an open street identifier protocol. I joined SharedStreets specifically to focus on the problem of linking branching street map data by common identifier via a fuzzy linear reference system. I believe robust common reference systems are a critical first step to building a distributed global base map (<code>git</code> got off easy on this step, since code has line numbers). In addition, I&#39;m increasingly excited by possibilities involving ultra flexible routing engines that are able to adapt to the rapidly accelerating velocity of data generation, either through smart merging &amp; tasking or development in CRDT resolution on the fly.</p>
<p><strong>Thanks for reading! Questions or comments can be emailed to <a href="mailto:morgan.herlocker@gmail.com">morgan.herlocker@gmail.com</a> or tweeted to <a href="https://twitter.com/morganherlocker">@morganherlocker</a>.</strong></p>
<hr>
<p><em>03-07-19</em></p>

  </body>
  <footer>
    <p>
      <hr>
      <a href="/about">about</a><span style="padding:5px"></span>
      <a href="https://twitter.com/morganherlocker">twitter</a><span style="padding:5px"></span>
      <a href="https://github.com/morganherlocker">github</a><span style="padding:5px"></span>
      <a href="/posts">posts</a>
    </p>
  </footer>
</html>